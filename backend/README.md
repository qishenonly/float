# FloatIsland Backend

FloatIsland ä¸ªäººè´¢åŠ¡ç®¡ç†åº”ç”¨åç«¯æœåŠ¡

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Go 1.21+ with Gin
- **æ•°æ®åº“**: MySQL 8.0+
- **ç¼“å­˜**: Redis 7+
- **ORM**: GORM (æ”¯æŒè‡ªåŠ¨è¿ç§»)
- **è®¤è¯**: JWT
- **æ—¥å¿—**: Zap
- **é…ç½®**: Viper

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ cmd/server/          # åº”ç”¨å…¥å£
â”œâ”€â”€ internal/            # å†…éƒ¨ä»£ç 
â”‚   â”œâ”€â”€ api/            # API å±‚
â”‚   â”‚   â”œâ”€â”€ handlers/   # HTTP å¤„ç†å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ middlewares/# ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ routes/     # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ service/        # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ repository/     # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ pkg/                # å…¬å…±åº“
â”‚   â”œâ”€â”€ cache/          # Redis å°è£…
â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“å°è£…
â”‚   â”œâ”€â”€ logger/         # æ—¥å¿—å°è£…
â”‚   â””â”€â”€ storage/        # å¯¹è±¡å­˜å‚¨å°è£…
â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ migrations/         # æ•°æ®åº“è¿ç§»ï¼ˆå¤‡ä»½ï¼‰
â”œâ”€â”€ deployments/        # éƒ¨ç½²é…ç½®
â”‚   â””â”€â”€ docker/         # Docker é…ç½®
â”œâ”€â”€ docs/               # æ–‡æ¡£
â””â”€â”€ tests/              # æµ‹è¯•
```

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Go 1.21+
- MySQL 8.0+
- Redis 7+
- Docker (å¯é€‰)

### æœ¬åœ°å¼€å‘

1. **å®‰è£…ä¾èµ–**

```bash
make deps
```

2. **é…ç½®ç¯å¢ƒ**

å¤åˆ¶é…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹ï¼š
```bash
cp config/config.yaml config/config.dev.yaml
# ç¼–è¾‘ config/config.dev.yaml é…ç½®æ•°æ®åº“ç­‰ä¿¡æ¯
```

3. **è¿è¡ŒæœåŠ¡ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ï¼‰**

```bash
make run
```

**â­ æ•°æ®åº“è¡¨è‡ªåŠ¨åˆ›å»º**
- ä½¿ç”¨ GORM AutoMigrate è‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°è¡¨ç»“æ„
- å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆ›å»ºç¼ºå¤±çš„è¡¨
- æ— éœ€æ‰‹åŠ¨æ‰§è¡Œ SQL è„šæœ¬

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨

### Docker éƒ¨ç½²

1. **æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡**

```bash
make docker-up
```

è¿™å°†å¯åŠ¨ï¼š
- API æœåŠ¡ (ç«¯å£ 8080)
- MySQL (ç«¯å£ 3306)
- Redis (ç«¯å£ 6379)
- MinIO (ç«¯å£ 9000, 9001)

2. **æŸ¥çœ‹æ—¥å¿—**

```bash
make docker-logs
```

3. **åœæ­¢æœåŠ¡**

```bash
make docker-down
```

## API æ–‡æ¡£

è¯¦ç»†çš„ API æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š
- [API è®¾è®¡æ–‡æ¡£](../design/api/api-spec.md)
- [æ¶æ„è®¾è®¡æ–‡æ¡£](../design/architecture/architecture.md)
- [ç”¨æˆ·è®¤è¯æµ‹è¯•æŒ‡å—](./docs/api/user_auth_guide.md)

### ä¸»è¦ç«¯ç‚¹

- `GET /health` - å¥åº·æ£€æŸ¥
- `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/v1/users/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `GET /api/v1/transactions` - è·å–äº¤æ˜“åˆ—è¡¨
- `POST /api/v1/transactions` - åˆ›å»ºäº¤æ˜“

## å¼€å‘æŒ‡å—

### æ•°æ®åº“è¿ç§»

**ä½¿ç”¨ GORM AutoMigrateï¼ˆæ¨èï¼‰**

åœ¨ `cmd/server/main.go` ä¸­æ·»åŠ æ–°æ¨¡å‹ï¼š

```go
database.AutoMigrate(
    &models.User{},
    &models.Transaction{},
    // æ·»åŠ æ–°æ¨¡å‹...
)
```

GORM ä¼šè‡ªåŠ¨ï¼š
- âœ… åˆ›å»ºè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- âœ… æ·»åŠ æ–°å­—æ®µ
- âœ… æ·»åŠ ç´¢å¼•
- âš ï¸ ä¸ä¼šåˆ é™¤å­—æ®µï¼ˆéœ€æ‰‹åŠ¨å¤„ç†ï¼‰

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

1. åœ¨ `internal/models/` å®šä¹‰æ•°æ®æ¨¡å‹
2. åœ¨ `internal/repository/` å®ç°æ•°æ®è®¿é—®
3. åœ¨ `internal/service/` å®ç°ä¸šåŠ¡é€»è¾‘
4. åœ¨ `internal/api/handlers/` æ·»åŠ å¤„ç†å‡½æ•°
5. åœ¨ `internal/api/routes/router.go` æ³¨å†Œè·¯ç”±
6. åœ¨ `main.go` çš„ AutoMigrate ä¸­æ·»åŠ æ¨¡å‹

## æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œç‰¹å®šæµ‹è¯•
go test -v ./internal/service/...
```

## é…ç½®è¯´æ˜

ä¸»è¦é…ç½®é¡¹ï¼ˆ`config/config.yaml`ï¼‰ï¼š

- `server.port`: æœåŠ¡ç«¯å£
- `database.*`: MySQL æ•°æ®åº“é…ç½®
- `redis.*`: Redis é…ç½®
- `jwt.secret`: JWT å¯†é’¥
- `storage.*`: å¯¹è±¡å­˜å‚¨é…ç½®

## å·²å®ç°åŠŸèƒ½

### âœ… ç”¨æˆ·è®¤è¯æ¨¡å—
- ç”¨æˆ·æ³¨å†Œï¼ˆå¸¦éªŒè¯ï¼‰
- ç”¨æˆ·ç™»å½•ï¼ˆJWTï¼‰
- Token åˆ·æ–°
- å¯†ç åŠ å¯†ï¼ˆbcryptï¼‰

### âœ… ç”¨æˆ·ç®¡ç†æ¨¡å—
- è·å–ç”¨æˆ·ä¿¡æ¯
- æ›´æ–°ç”¨æˆ·èµ„æ–™
- ä¿®æ”¹å¯†ç 
- ç”¨æˆ·ç»Ÿè®¡

### ğŸ”œ å¾…å®ç°æ¨¡å—
- äº¤æ˜“è®°å½•ç®¡ç†
- è´¦æˆ·ç®¡ç†
- åˆ†ç±»ç®¡ç†
- è´¦å•è®¢é˜…
- å‚¨è“„è®¡åˆ’
- å¿ƒæ„¿å•
- é¢„ç®—ç®¡ç†
- é€šçŸ¥ç³»ç»Ÿ
- æ•°æ®å¯¼å‡º

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License

---

**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2025-12-05
